kind: pipeline
name: default
trigers:
  branch:
    - dev
    - master
  event:
    - push

steps:
  - name: code-analysis
    image: aosapps/drone-sonar-plugin
    settings:
      sonar_host:
        from_secret: sonar_host
      sonar_token:
        from_secret: sonar_token
    sources: ./src

---
kind: pipeline
name: build-dev
depends_on:
  - default
trigers:
  branch:
    - dev
  event:
    - push
steps:
  - name: install
    image: node:10
    commands:
      - npm install

  - name: publish
    image: banzaicloud/drone-kaniko
    settings:
      registry: gcr.io
      repo: redfox-doutor-alper/alper-api-dev
      tags:
        - latest
      username: _json_key
      password:
        from_secret: gcp_credentials
---        
kind: pipeline
name: build-prod
depends_on:
  - default
trigers:
  branch:
    - master
  event:
    - push
steps:
  - name: install
    image: node:10
    commands:
      - npm install

  - name: publish
    image: banzaicloud/drone-kaniko
    settings:
      registry: gcr.io
      repo: redfox-doutor-alper/alper-api-prod
      tags:
        - latest
      username: _json_key
      password:
        from_secret: gcp_credentials

